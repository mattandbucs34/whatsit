
> whatsit@1.0.0 test C:\Users\matta\Documents\Projects\whatsit
> vitest run --no-file-parallelism


[1m[46m RUN [49m[22m [36mv4.0.16 [39m[90mC:/Users/matta/Documents/Projects/whatsit[39m

[90mstdout[2m | spec/integration/favorites.spec.js
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
--- DB INIT ---
ENV: test
CONFIG: {
  "use_env_variable": "DATABASE_URL_TEST",
  "dialect": "postgres",
  "logging": false
}
VAR_NAME: DATABASE_URL_TEST
VAR_VALUE_EXISTS: [33mtrue[39m
VAR_VALUE_START: postgres:/

[90mstdout[2m | spec/integration/favorites.spec.js[2m > [22m[2mroutes : favorites[2m > [22m[2mguest attempting to favorite a post[2m > [22m[2mPOST /topics/:topicId/posts/:postId/favorites/create[2m > [22m[2mshould not create a new favorite
[22m[39mTOPIC ID:  [33m1[39m
POST ID:  [33m2[39m

(node:6192) [DEP0044] DeprecationWarning: The `util.isArray` API is deprecated. Please use `Array.isArray()` instead.
(Use `node --trace-deprecation ...` to show where the warning was created)
 [31m‚ùØ[39m spec/integration/favorites.spec.js [2m([22m[2m4 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 759[2mms[22m[39m
[31m         [31m√ó[31m should not create a new favorite[39m[33m 303[2mms[22m[39m
         [32m‚úì[39m should create a favorite[32m 150[2mms[22m[39m
[31m         [31m√ó[31m should destroy a favorite[39m[32m 149[2mms[22m[39m
         [32m‚úì[39m should not destroy a favorite[32m 156[2mms[22m[39m
[90mstdout[2m | spec/integration/topics.spec.js
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops
--- DB INIT ---
ENV: test
CONFIG: {
  "use_env_variable": "DATABASE_URL_TEST",
  "dialect": "postgres",
  "logging": false
}
VAR_NAME: DATABASE_URL_TEST
VAR_VALUE_EXISTS: [33mtrue[39m
VAR_VALUE_START: postgres:/

(node:45448) [DEP0044] DeprecationWarning: The `util.isArray` API is deprecated. Please use `Array.isArray()` instead.
(Use `node --trace-deprecation ...` to show where the warning was created)
 [32m‚úì[39m spec/integration/topics.spec.js [2m([22m[2m17 tests[22m[2m)[22m[33m 2706[2mms[22m[39m
[90mstdout[2m | spec/integration/posts.spec.js
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }
--- DB INIT ---
ENV: test
CONFIG: {
  "use_env_variable": "DATABASE_URL_TEST",
  "dialect": "postgres",
  "logging": false
}
VAR_NAME: DATABASE_URL_TEST
VAR_VALUE_EXISTS: [33mtrue[39m
VAR_VALUE_START: postgres:/

(node:37772) [DEP0044] DeprecationWarning: The `util.isArray` API is deprecated. Please use `Array.isArray()` instead.
(Use `node --trace-deprecation ...` to show where the warning was created)
 [32m‚úì[39m spec/integration/posts.spec.js [2m([22m[2m14 tests[22m[2m)[22m[33m 2181[2mms[22m[39m
[90mstdout[2m | spec/integration/votes.spec.js
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops
--- DB INIT ---
ENV: test
CONFIG: {
  "use_env_variable": "DATABASE_URL_TEST",
  "dialect": "postgres",
  "logging": false
}
VAR_NAME: DATABASE_URL_TEST
VAR_VALUE_EXISTS: [33mtrue[39m
VAR_VALUE_START: postgres:/

(node:42944) [DEP0044] DeprecationWarning: The `util.isArray` API is deprecated. Please use `Array.isArray()` instead.
(Use `node --trace-deprecation ...` to show where the warning was created)
[90mstdout[2m | spec/integration/votes.spec.js[2m > [22m[2mroutes : votes[2m > [22m[2mGET /topics/:topicId/posts/:postId/votes/upvote||downvote[2m > [22m[2mshould update upvote to downvote for signed in user
[22m[39mVOTE:  Vote {
  dataValues: {
    id: [33m3[39m,
    value: [33m1[39m,
    postId: [33m1[39m,
    userId: [33m1[39m,
    createdAt: [35m2026-01-13T15:55:41.596Z[39m,
    updatedAt: [35m2026-01-13T15:55:41.596Z[39m
  },
  _previousDataValues: {
    id: [33m3[39m,
    value: [33m1[39m,
    postId: [33m1[39m,
    userId: [33m1[39m,
    createdAt: [35m2026-01-13T15:55:41.596Z[39m,
    updatedAt: [35m2026-01-13T15:55:41.596Z[39m
  },
  uniqno: [33m1[39m,
  _changed: Set(0) {},
  _options: {
    isNewRecord: [33mfalse[39m,
    _schema: [1mnull[22m,
    _schemaDelimiter: [32m''[39m,
    raw: [33mtrue[39m,
    attributes: [ [32m'id'[39m, [32m'value'[39m, [32m'postId'[39m, [32m'userId'[39m, [32m'createdAt'[39m, [32m'updatedAt'[39m ]
  },
  isNewRecord: [33mfalse[39m
}

 [32m‚úì[39m spec/integration/votes.spec.js [2m([22m[2m8 tests[22m[2m)[22m[33m 1366[2mms[22m[39m
         [33m[2m‚úì[22m[39m should not create a new vote [33m 307[2mms[22m[39m
[90mstdout[2m | spec/integration/flairs.spec.js
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
--- DB INIT ---
ENV: test
CONFIG: {
  "use_env_variable": "DATABASE_URL_TEST",
  "dialect": "postgres",
  "logging": false
}
VAR_NAME: DATABASE_URL_TEST
VAR_VALUE_EXISTS: [33mtrue[39m
VAR_VALUE_START: postgres:/

[90mstdout[2m | spec/integration/flairs.spec.js[2m > [22m[2mroutes : flairs[2m > [22m[2mPOST /flairs/create[2m > [22m[2mshould create a new flair and redirect
[22m[39mNEW FLAIR DATA:  { name: [32m'Zing Flair'[39m, color: [32m'grey'[39m }

[90mstdout[2m | spec/integration/flairs.spec.js[2m > [22m[2mroutes : flairs[2m > [22m[2mPOST /flairs/create[2m > [22m[2mshould create a new flair and redirect
[22m[39mFLAIR:  Flair {
  dataValues: {
    id: [33m2[39m,
    name: [32m'Zing Flair'[39m,
    color: [32m'grey'[39m,
    createdAt: [35m2026-01-13T15:55:43.645Z[39m,
    updatedAt: [35m2026-01-13T15:55:43.645Z[39m
  },
  _previousDataValues: {
    id: [33m2[39m,
    name: [32m'Zing Flair'[39m,
    color: [32m'grey'[39m,
    createdAt: [35m2026-01-13T15:55:43.645Z[39m,
    updatedAt: [35m2026-01-13T15:55:43.645Z[39m
  },
  uniqno: [33m1[39m,
  _changed: Set(0) {},
  _options: {
    isNewRecord: [33mfalse[39m,
    _schema: [1mnull[22m,
    _schemaDelimiter: [32m''[39m,
    raw: [33mtrue[39m,
    attributes: [ [32m'id'[39m, [32m'name'[39m, [32m'color'[39m, [32m'createdAt'[39m, [32m'updatedAt'[39m ]
  },
  isNewRecord: [33mfalse[39m
}

 [32m‚úì[39m spec/integration/flairs.spec.js [2m([22m[2m7 tests[22m[2m)[22m[33m 1318[2mms[22m[39m
       [33m[2m‚úì[22m[39m should update the flair with the given information [33m 312[2mms[22m[39m
[90mstdout[2m | spec/integration/advert.spec.js
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
--- DB INIT ---
ENV: test
CONFIG: {
  "use_env_variable": "DATABASE_URL_TEST",
  "dialect": "postgres",
  "logging": false
}
VAR_NAME: DATABASE_URL_TEST
VAR_VALUE_EXISTS: [33mtrue[39m
VAR_VALUE_START: postgres:/

 [32m‚úì[39m spec/integration/advert.spec.js [2m([22m[2m7 tests[22m[2m)[22m[33m 1180[2mms[22m[39m
[90mstdout[2m | spec/integration/comments.spec.js
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops
--- DB INIT ---
ENV: test
CONFIG: {
  "use_env_variable": "DATABASE_URL_TEST",
  "dialect": "postgres",
  "logging": false
}
VAR_NAME: DATABASE_URL_TEST
VAR_VALUE_EXISTS: [33mtrue[39m
VAR_VALUE_START: postgres:/

[90mstderr[2m | spec/integration/comments.spec.js[2m > [22m[2mroutes : comments[2m > [22m[2mguest attempting to perform CRUD operations for Comment[2m > [22m[2mPOST /topics/:topicId/posts/:postId/comments/create[2m > [22m[2mshould not create a new comment
[22m[39mThere was an issue creating this comment:  Error: 
    at Query.run [90m(C:\Users\matta\Documents\Projects\whatsit\[39mnode_modules\[4m.pnpm[24m\sequelize@6.37.7_pg-hstore@2.3.4_pg@8.16.3\node_modules\[4msequelize[24m\lib\dialects\postgres\query.js:50:25[90m)[39m
    at [90mC:\Users\matta\Documents\Projects\whatsit\[39mnode_modules\[4m.pnpm[24m\sequelize@6.37.7_pg-hstore@2.3.4_pg@8.16.3\node_modules\[4msequelize[24m\lib\sequelize.js:315:28
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at PostgresQueryInterface.insert [90m(C:\Users\matta\Documents\Projects\whatsit\[39mnode_modules\[4m.pnpm[24m\sequelize@6.37.7_pg-hstore@2.3.4_pg@8.16.3\node_modules\[4msequelize[24m\lib\dialects\abstract\query-interface.js:308:21[90m)[39m
    at model.save [90m(C:\Users\matta\Documents\Projects\whatsit\[39mnode_modules\[4m.pnpm[24m\sequelize@6.37.7_pg-hstore@2.3.4_pg@8.16.3\node_modules\[4msequelize[24m\lib\model.js:2490:35[90m)[39m
    at Function.create [90m(C:\Users\matta\Documents\Projects\whatsit\[39mnode_modules\[4m.pnpm[24m\sequelize@6.37.7_pg-hstore@2.3.4_pg@8.16.3\node_modules\[4msequelize[24m\lib\model.js:1362:12[90m)[39m
    at createComment (C:/Users/matta/Documents/Projects/whatsit/src/db/queries.comments.js:7:26)
    at create (C:/Users/matta/Documents/Projects/whatsit/src/controllers/commentController.js:14:26) {
  name: [32m'SequelizeForeignKeyConstraintError'[39m,
  parent: error: insert or update on table "Comments" violates foreign key constraint "Comments_userId_fkey"
      at Parser.parseErrorMessage [90m(C:\Users\matta\Documents\Projects\whatsit\[39mnode_modules\[4m.pnpm[24m\pg-protocol@1.10.3\node_modules\[4mpg-protocol[24m\dist\parser.js:285:98[90m)[39m
      at Parser.handlePacket [90m(C:\Users\matta\Documents\Projects\whatsit\[39mnode_modules\[4m.pnpm[24m\pg-protocol@1.10.3\node_modules\[4mpg-protocol[24m\dist\parser.js:122:29[90m)[39m
      at Parser.parse [90m(C:\Users\matta\Documents\Projects\whatsit\[39mnode_modules\[4m.pnpm[24m\pg-protocol@1.10.3\node_modules\[4mpg-protocol[24m\dist\parser.js:35:38[90m)[39m
      at Socket.<anonymous> [90m(C:\Users\matta\Documents\Projects\whatsit\[39mnode_modules\[4m.pnpm[24m\pg-protocol@1.10.3\node_modules\[4mpg-protocol[24m\dist\index.js:11:42[90m)[39m
  [90m    at Socket.emit (node:events:518:28)[39m
  [90m    at addChunk (node:internal/streams/readable:561:12)[39m
  [90m    at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)[39m
  [90m    at Socket.Readable.push (node:internal/streams/readable:392:5)[39m
  [90m    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)[39m {
    length: [33m251[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23503'[39m,
    detail: [32m'Key (userId)=(0) is not present in table "Users".'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [90mundefined[39m,
    schema: [32m'public'[39m,
    table: [32m'Comments'[39m,
    column: [90mundefined[39m,
    dataType: [90mundefined[39m,
    constraint: [32m'Comments_userId_fkey'[39m,
    file: [32m'ri_triggers.c'[39m,
    line: [32m'2607'[39m,
    routine: [32m'ri_ReportViolation'[39m,
    sql: [32m'INSERT INTO "Comments" ("id","body","postId","userId","createdAt","updatedAt") VALUES (DEFAULT,$1,$2,$3,$4,$5) RETURNING "id","body","postId","userId","createdAt","updatedAt";'[39m,
    parameters: [
      [32m'This comment is amazing!'[39m,
      [32m'1'[39m,
      [32m'0'[39m,
      [32m'2026-01-13 15:55:48.849 +00:00'[39m,
      [32m'2026-01-13 15:55:48.849 +00:00'[39m
    ]
  },
  original: error: insert or update on table "Comments" violates foreign key constraint "Comments_userId_fkey"
      at Parser.parseErrorMessage [90m(C:\Users\matta\Documents\Projects\whatsit\[39mnode_modules\[4m.pnpm[24m\pg-protocol@1.10.3\node_modules\[4mpg-protocol[24m\dist\parser.js:285:98[90m)[39m
      at Parser.handlePacket [90m(C:\Users\matta\Documents\Projects\whatsit\[39mnode_modules\[4m.pnpm[24m\pg-protocol@1.10.3\node_modules\[4mpg-protocol[24m\dist\parser.js:122:29[90m)[39m
      at Parser.parse [90m(C:\Users\matta\Documents\Projects\whatsit\[39mnode_modules\[4m.pnpm[24m\pg-protocol@1.10.3\node_modules\[4mpg-protocol[24m\dist\parser.js:35:38[90m)[39m
      at Socket.<anonymous> [90m(C:\Users\matta\Documents\Projects\whatsit\[39mnode_modules\[4m.pnpm[24m\pg-protocol@1.10.3\node_modules\[4mpg-protocol[24m\dist\index.js:11:42[90m)[39m
  [90m    at Socket.emit (node:events:518:28)[39m
  [90m    at addChunk (node:internal/streams/readable:561:12)[39m
  [90m    at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)[39m
  [90m    at Socket.Readable.push (node:internal/streams/readable:392:5)[39m
  [90m    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)[39m {
    length: [33m251[39m,
    severity: [32m'ERROR'[39m,
    code: [32m'23503'[39m,
    detail: [32m'Key (userId)=(0) is not present in table "Users".'[39m,
    hint: [90mundefined[39m,
    position: [90mundefined[39m,
    internalPosition: [90mundefined[39m,
    internalQuery: [90mundefined[39m,
    where: [90mundefined[39m,
    schema: [32m'public'[39m,
    table: [32m'Comments'[39m,
    column: [90mundefined[39m,
    dataType: [90mundefined[39m,
    constraint: [32m'Comments_userId_fkey'[39m,
    file: [32m'ri_triggers.c'[39m,
    line: [32m'2607'[39m,
    routine: [32m'ri_ReportViolation'[39m,
    sql: [32m'INSERT INTO "Comments" ("id","body","postId","userId","createdAt","updatedAt") VALUES (DEFAULT,$1,$2,$3,$4,$5) RETURNING "id","body","postId","userId","createdAt","updatedAt";'[39m,
    parameters: [
      [32m'This comment is amazing!'[39m,
      [32m'1'[39m,
      [32m'0'[39m,
      [32m'2026-01-13 15:55:48.849 +00:00'[39m,
      [32m'2026-01-13 15:55:48.849 +00:00'[39m
    ]
  },
  sql: [32m'INSERT INTO "Comments" ("id","body","postId","userId","createdAt","updatedAt") VALUES (DEFAULT,$1,$2,$3,$4,$5) RETURNING "id","body","postId","userId","createdAt","updatedAt";'[39m,
  parameters: [
    [32m'This comment is amazing!'[39m,
    [32m'1'[39m,
    [32m'0'[39m,
    [32m'2026-01-13 15:55:48.849 +00:00'[39m,
    [32m'2026-01-13 15:55:48.849 +00:00'[39m
  ],
  table: [32m'Comments'[39m,
  fields: [1mnull[22m,
  value: [90mundefined[39m,
  index: [32m'Comments_userId_fkey'[39m,
  reltype: [90mundefined[39m
}

(node:61936) [DEP0044] DeprecationWarning: The `util.isArray` API is deprecated. Please use `Array.isArray()` instead.
(Use `node --trace-deprecation ...` to show where the warning was created)
 [32m‚úì[39m spec/integration/comments.spec.js [2m([22m[2m6 tests[22m[2m)[22m[33m 1253[2mms[22m[39m
         [33m[2m‚úì[22m[39m should not create a new comment [33m 312[2mms[22m[39m
         [33m[2m‚úì[22m[39m should delete the comment with the associated ID [33m 304[2mms[22m[39m
[90mstdout[2m | spec/integration/users.spec.js
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops
--- DB INIT ---
ENV: test
CONFIG: {
  "use_env_variable": "DATABASE_URL_TEST",
  "dialect": "postgres",
  "logging": false
}
VAR_NAME: DATABASE_URL_TEST
VAR_VALUE_EXISTS: [33mtrue[39m
VAR_VALUE_START: postgres:/

(node:33732) [DEP0044] DeprecationWarning: The `util.isArray` API is deprecated. Please use `Array.isArray()` instead.
(Use `node --trace-deprecation ...` to show where the warning was created)
 [32m‚úì[39m spec/integration/users.spec.js [2m([22m[2m5 tests[22m[2m)[22m[33m 922[2mms[22m[39m
       [33m[2m‚úì[22m[39m should create a new user with valid values and redirect [33m 335[2mms[22m[39m
[90mstdout[2m | spec/integration/static.spec.js
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`
--- DB INIT ---
ENV: test
CONFIG: {
  "use_env_variable": "DATABASE_URL_TEST",
  "dialect": "postgres",
  "logging": false
}
VAR_NAME: DATABASE_URL_TEST
VAR_VALUE_EXISTS: [33mtrue[39m
VAR_VALUE_START: postgres:/

 [32m‚úì[39m spec/integration/static.spec.js [2m([22m[2m2 tests[22m[2m)[22m[32m 38[2mms[22m[39m

[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m[1m[41m Failed Tests 2 [49m[22m[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m

[41m[1m FAIL [22m[49m spec/integration/favorites.spec.js[2m > [22mroutes : favorites[2m > [22mguest attempting to favorite a post[2m > [22mPOST /topics/:topicId/posts/:postId/favorites/create[2m > [22mshould not create a new favorite
[31m[1mAssertionError[22m: expected 2 to be 3 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 3[39m
[31m+ 2[39m

[36m [2m‚ùØ[22m spec/integration/favorites.spec.js:[2m70:46[22m[39m
    [90m 68| [39m                [35mconst[39m favoritesAfterCreate [33m=[39m [35mawait[39m [33mFavorite[39m[33m.[39m[34mcount[39m()[33m;[39m
    [90m 69| [39m
    [90m 70| [39m                expect(favoritesAfterCreate).toBe(favortiesBeforeCreat‚Ä¶
    [90m   | [39m                                             [31m^[39m
    [90m 71| [39m            })[33m;[39m
    [90m 72| [39m        })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[1/2]‚éØ[22m[39m

[41m[1m FAIL [22m[49m spec/integration/favorites.spec.js[2m > [22mroutes : favorites[2m > [22msigned in user favoriting a post[2m > [22mPOST /topics/:topicId/posts/:postId/favorites/:id/destroy[2m > [22mshould destroy a favorite
[31m[1mAssertionError[22m: expected 2 to be 1 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 1[39m
[31m+ 2[39m

[36m [2m‚ùØ[22m spec/integration/favorites.spec.js:[2m122:45[22m[39m
    [90m120| [39m                [35mconst[39m favCountAfterDelete [33m=[39m [35mawait[39m [33mFavorite[39m[33m.[39m[34mcount[39m()[33m;[39m
    [90m121| [39m
    [90m122| [39m                expect(favCountAfterDelete).toBe(favCountBeforeDelete ‚Ä¶
    [90m   | [39m                                            [31m^[39m
    [90m123| [39m            })[33m;[39m
    [90m124| [39m        })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[2/2]‚éØ[22m[39m


[2m Test Files [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m8 passed[39m[22m[90m (9)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m68 passed[39m[22m[90m (70)[39m
[2m   Start at [22m 09:55:28
[2m   Duration [22m 25.43s[2m (transform 366ms, setup 0ms, import 11.27s, tests 11.72s, environment 1ms)[22m

‚ÄâELIFECYCLE‚Äâ Test failed. See above for more details.
